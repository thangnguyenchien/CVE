import sys
import binascii

out_path = "../../"

if len(sys.argv) != 4:
    print("Usage: python script.py <filename> <outfile> <key>")
    exit(1)

file_name = sys.argv[1]
out_file = sys.argv[2]
key_in_hex = sys.argv[3]
ext = sys.argv[1].split('.')

if len(ext) > 2:
    ext = str('.' + ext[len(ext) - 1])

if key_in_hex.startswith('0x'):
    key_in_hex = key_in_hex.replace('0x','')

if len(key_in_hex) % 2 != 0:
    print("[Error]: did you mean {}0".format(key_in_hex))

key_len = len(key_in_hex) // 2
key = binascii.unhexlify(key_in_hex)

with open(file_name, 'rb') as f, open(out_path+out_file, 'wb') as f_o:
    b_file = f.read()
    b_c = [b_file[i:i + key_len] for i in range(0, len(b_file), key_len)]
    enc_file = []
    for c in b_c:
        for k, p in zip(key, c):
            enc_file.append(k^p)
        #print(b)
        #print(bytes(cp))
    f_o.write(bytes(enc_file))